<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groupie Tracker</title>
    <link rel="stylesheet" href="static/styles.css">
</head>

<body>

    <div class="container">
        <!-- Header with Title -->
        <header>
            <h1>Groupie Tracker</h1>
        </header>

        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search for artists..." onkeyup="searchArtists()">
        </div>

        <!-- Artist Cards Grid -->
        <div class="artist-grid">
            {{ range .Artists }}
            <div class="artist-card" data-artist-name="{{ .Name }}" data-artist-id="{{ .ID }}">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="artist-name">{{ .Name }}</div>
                        <div class="artist-image" style="background-image: url('{{ .Image }}');"></div>
                        <div class="artist-info">
                            <p>Year Established: <strong>{{ .CreationDate }}</strong></p>
                            <p>First Album: <strong>{{ .FirstAlbum }}</strong></p>
                            <p>Members: <strong>{{ len .Members }}</strong></p>
                        </div>
                    </div>
                    <div class="card-members">
                        <h3 class="category-title">Members</h3>
                        <ul>
                            {{ range .Members }}
                            <li>{{ . }}</li>
                            {{ end }}
                        </ul>
                    </div>
                    <div class="card-locations">
                        <h3 class="category-title">Locations</h3>
                        <ul class="locations-list">
                            <!-- Locations will be added here -->
                        </ul>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
    <footer>A Zone01 Project by Uipko, Giannis, Arsen - Â© All Rights Reserved</footer>
</body>
<script>
    const cardStates = [];

    document.addEventListener("DOMContentLoaded", () => {
        const cards = document.querySelectorAll(".artist-card");
        cards.forEach((card, index) => {
            cardStates[index] = 0;
            card.addEventListener("click", () => flipCard(card, index));
        });
    });

    function flipCard(cardElement, index) {
        const artistName = cardElement.getAttribute('data-artist-name');
        const artistId = cardElement.getAttribute('data-artist-id');
        let nextFlipCount = (cardStates[index] + 1) % 3;

        // Log which section we're about to flip to
        if (nextFlipCount === 0) {
            console.log(`About to flip ${artistName}'s card to: Front Side`);
        } else if (nextFlipCount === 1) {
            console.log(`About to flip ${artistName}'s card to: Members Section`);
        } else {
            console.log(`About to flip ${artistName}'s card to: Locations Section`);
            // When flipping to locations, fetch and display the data
            const locationsList = cardElement.querySelector('.locations-list');
            locationsList.innerHTML = '<li>Loading locations...</li>';
            
            fetch(`/api/locations?id=${artistId}`)
                .then(response => response.json())
                .then(locations => {
                    locationsList.innerHTML = locations.map(location => 
                        `<li>${location}</li>`
                    ).join('');
                })
                .catch(error => {
                    locationsList.innerHTML = '<li>Error loading locations</li>';
                    console.error('Error:', error);
                });
        }

        cardStates[index] = nextFlipCount;

        const cardInner = cardElement.querySelector(".card-inner");
        const front = cardElement.querySelector(".card-front");
        const members = cardElement.querySelector(".card-members");
        const locations = cardElement.querySelector(".card-locations");

        front.style.opacity = "0";
        members.style.opacity = "0";
        locations.style.opacity = "0";

        if (nextFlipCount === 0) {
            cardInner.style.transform = "rotateY(0deg)";
            front.style.opacity = "1";
        } else if (nextFlipCount === 1) {
            cardInner.style.transform = "rotateY(180deg)";
            members.style.opacity = "1";
        } else {
            cardInner.style.transform = "rotateY(360deg)";
            locations.style.opacity = "1";
        }
    }
</script>

</html>
